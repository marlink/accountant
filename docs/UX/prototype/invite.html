<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Prototype — Współpracownik</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>
<a href="#main-content" class="skip-link">Przejdź do treści głównej</a>
<header role="banner">
<nav role="navigation" aria-label="Główne menu nawigacyjne">
  <a href="index.html">Dashboard</a>
  <a href="invoicing.html">Faktura</a>
  <a href="invoice.html">Szczegóły FV</a>
  <a href="costs.html">Koszt/OCR</a>
  <a href="bank.html">Bank/AIS</a>
  <a href="vat.html">VAT/JPK</a>
  <a href="invite.html" aria-current="page">Współpracownik</a>
  <a href="notifications.html">Powiadomienia</a>
  <a href="reports.html">Raporty</a>
  <a href="settings.html">Ustawienia</a>
  <a href="errors.html">Błędy</a>
</nav>
</header>
<main id="main-content" role="main">
<h1 class="sr-only">Zaproś współpracownika</h1>
<form class="form-grid form-grid-invite" aria-label="Formularz zapraszania współpracownika">
  <div class="form-group">
    <label for="identifier">E-mail, telefon lub pseudonim</label>
    <input id="identifier" type="text" placeholder="user@example.com, +48123456789 lub Jan Kowalski" aria-required="true" aria-describedby="identifier-error">
    <span id="identifier-error" class="sr-only" role="alert"></span>
  </div>
  <div class="form-group">
    <label for="rola">Rola</label>
    <select id="rola" aria-required="true">
      <option>Owner</option>
      <option>Accountant</option>
      <option>Office Manager</option>
    </select>
  </div>
  <div class="form-group align-end">
    <button id="invite" type="submit" class="btn-secondary">Zaproś</button>
  </div>
</form>
<div id="status" role="status" aria-live="polite" aria-atomic="true"></div>
<div class="screen-toggle-container">
  <label class="screen-toggle">
    <input id="small" type="checkbox" aria-label="Przełącz na mały ekran (390px)"> <span>Mały ekran (390px)</span>
  </label>
</div>
<div id="wrap">
  <object class="frame" type="image/svg+xml" data="../wireframes/roles_invite.svg" aria-label="Zapraszanie współpracownika wireframe"></object>
</div>
</main>
<script>
(function(){
  const form = document.querySelector('form');
  const identifierInput = document.getElementById('identifier');
  const identifierError = document.getElementById('identifier-error');
  const s = document.getElementById('status');
  
  function showStatus(message, type){
    s.textContent = message;
    s.className = type;
    s.setAttribute('aria-live', 'assertive');
  }
  
  function detectIdentifierType(value){
    const trimmed = value.trim();
    
    // Email validation: contains @ and . with valid format
    if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(trimmed)){
      return { type: 'email', valid: true };
    }
    
    // Phone validation: Polish format - 9+ digits (with optional +48 prefix, spaces, dashes, parentheses)
    // Examples: +48123456789, 48123456789, 123456789, +48 123 456 789, 123-456-789
    const digitsOnly = trimmed.replace(/[\s\-+()]/g, '');
    if(/^(\+?48)?\d{9,12}$/.test(digitsOnly) && digitsOnly.length >= 9){
      return { type: 'phone', valid: true };
    }
    
    // Nickname: at least 2 characters, no special validation
    if(trimmed.length >= 2){
      return { type: 'nickname', valid: true };
    }
    
    return { type: null, valid: false };
  }
  
  form.addEventListener('submit', function(event){
    event.preventDefault();
    const identifier = identifierInput.value.trim();
    const r = document.getElementById('rola').value;
    
    if(!identifier){
      identifierInput.classList.add('error');
      identifierInput.setAttribute('aria-invalid', 'true');
      identifierError.textContent = 'Wprowadź e-mail, numer telefonu lub pseudonim';
      showStatus('Błąd: wprowadź e-mail, numer telefonu lub pseudonim', 'error');
      return;
    }
    
    const detected = detectIdentifierType(identifier);
    
    if(!detected.valid){
      identifierInput.classList.add('error');
      identifierInput.setAttribute('aria-invalid', 'true');
      identifierError.textContent = 'Nieprawidłowy format. Wprowadź e-mail, numer telefonu lub pseudonim (min. 2 znaki)';
      showStatus('Błąd: nieprawidłowy format', 'error');
      return;
    }
    
    identifierInput.classList.remove('error');
    identifierInput.setAttribute('aria-invalid', 'false');
    identifierError.textContent = '';
    
    const typeLabel = detected.type === 'email' ? 'e-mail' : detected.type === 'phone' ? 'telefon' : 'pseudonim';
    showStatus('Zaproszono ' + identifier + ' (' + typeLabel + ') jako ' + r, 'success');
  });
  
  // small screen toggle
  const small = document.getElementById('small');
  const wrap = document.getElementById('wrap');
  const frame = document.querySelector('.frame');
  const orig = frame.style.height || '720px';
  function apply(){
    if(small && small.checked){
      wrap.style.maxWidth = '390px';
      frame.style.height = '600px';
    } else {
      wrap.style.maxWidth = 'none';
      frame.style.height = orig;
    }
  }
  if(small){
    small.addEventListener('change', apply);
    apply();
  }
})();
</script>
</body>
</html>
